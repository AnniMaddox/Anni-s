<!DOCTYPE html>

<html lang="zh-CN">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0, user-scalable=no" name="viewport"/>
<meta content="yes" name="apple-mobile-web-app-capable"/>
<link href="https://i.postimg.cc/hPdpVBz0/IMG-1372.jpg" rel="apple-touch-icon"/>
<meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"/>
<title>EPhone</title>
<script src="https://unpkg.com/dexie/dist/dexie.js"></script>

<link href="./styles.css" rel="stylesheet"/>
    <link rel="stylesheet" href="./drawer.css"/>
    <script defer src="./drawer.js"></script>
  </head>
<body>
<div id="phone-screen">
<div id="notification-bar"><img id="notification-avatar" src=""/><div id="notification-content"><div class="name"></div><div class="message"></div></div></div>
<div class="screen active" id="home-screen">
<div id="clock-container"><div id="main-time">12:00</div><div id="main-date">星期一, 1月1日</div></div>
<!-- ▼▼▼ 用这整块代码替换你原来的 id="app-grid" ▼▼▼ -->
<div id="app-grid">
<!-- 第一行：放2个图标 -->
<div class="app-row">
<div class="app-icon" onclick="showScreen('world-book-screen')">
<div class="icon-bg">
<!-- 【核心修改1】添加ID -->
<img alt="世界書" id="icon-img-world-book" src="https://i.postimg.cc/HWf1JKzn/IMG-6435.jpg"/>
</div>
<span class="label">世界書</span>
</div>
<div class="app-icon" onclick="showScreen('chat-list-screen')">
<div class="icon-bg">
<!-- 【核心修改2】添加ID -->
<img alt="訊息" id="icon-img-qq" src="https://i.postimg.cc/MTC3Tkw8/IMG-6436.jpg"/>
</div>
<span class="label">訊息</span>
</div>
</div>
<!-- 第二行：放3个图标 -->
<div class="app-row">
<div class="app-icon" onclick="showScreen('api-settings-screen')">
<div class="icon-bg">
<!-- 【核心修改3】添加ID -->
<img alt="API設置" id="icon-img-api-settings" src="https://i.postimg.cc/MK8rJ8t7/IMG-6438.jpg"/>
</div>
<span class="label">API設置</span>
</div>
<div class="app-icon" onclick="showScreen('wallpaper-screen')">
<div class="icon-bg">
<!-- 【核心修改4】添加ID -->
<img alt="外觀設置" id="icon-img-wallpaper" src="https://i.postimg.cc/T1j03pQr/IMG-6440.jpg"/>
</div>
<span class="label">外觀設置</span>
</div>
<div class="app-icon" onclick="showScreen('font-settings-screen')">
<div class="icon-bg">
<!-- 【核心修改5】添加ID -->
<img alt="字體" id="icon-img-font" src="https://i.postimg.cc/pXxk1JXk/IMG-6442.jpg"/>
</div>
<span class="label">字體</span>
</div>
</div>
</div>
<!-- ▲▲▲ 替换结束 ▲▲▲ -->
</div>
<div class="screen" id="world-book-screen">
<div class="header">
<span class="back-btn" onclick="showScreen('home-screen')">‹</span>
<span>世界書</span>
<div class="header-actions"> <!-- 【推荐】用一个容器把按钮包起来 -->
<span class="action-btn" id="manage-world-book-categories-btn">管理分類</span>
<span class="action-btn" id="add-world-book-btn">+</span>
</div>
</div>
<div id="world-book-list"></div>
</div>
<div class="screen" id="world-book-editor-screen">
<div class="header">
<span class="back-btn" onclick="showScreen('world-book-screen')">‹</span>
<span id="world-book-editor-title">編輯世界書</span>
<span class="save-btn" id="save-world-book-btn">保存</span>
</div>
<div class="form-container">
<div class="form-group">
<label for="world-book-name-input">書名</label>
<input id="world-book-name-input" placeholder="請輸入世界書的名稱..." type="text"/>
</div>
<!-- ▼▼▼ 【全新】在这里添加分类选择 ▼▼▼ -->
<div class="form-group">
<label for="world-book-category-select">分類</label>
<select id="world-book-category-select">
<!-- 选项将由JS动态生成 -->
</select>
</div>
<!-- ▲▲▲ 添加结束 ▲▲▲ -->
<div class="form-group" style="height: 100%;">
<label for="world-book-content-input">內容</label>
<textarea id="world-book-content-input" placeholder="在此輸入詳細的世界觀設定..."></textarea>
</div>
</div>
</div>
<div class="screen" id="api-settings-screen"><div class="header"><span class="back-btn" onclick="showScreen('home-screen')">‹</span><span>API 設置</span><span style="width: 30px;"></span></div><div class="form-container"><p style="font-size: 14px; color: #666; background-color: #f0f0f0; padding: 10px; border-radius: 8px;">提示: 若要使用“發送圖片”功能, 請務必選擇支持Vision(視覺)的模型, 如<code style="background-color: #e0e0e0; padding: 2px 4px; border-radius: 4px;">gpt-4o</code>或<code style="background-color: #e0e0e0; padding: 2px 4px; border-radius: 4px;">gpt-4-vision-preview</code>。</p><div class="form-group"><label for="proxy-url">反代地址 (不需要添加/v1噢~)</label><input id="proxy-url" placeholder="例如: https://api.openai.com" type="text"/></div><div class="form-group"><label for="api-key">密鑰 (直連輪詢用英文逗號隔開)</label><input id="api-key" placeholder="sk-..." type="password"/></div><div class="form-group"><label for="model-select">模型</label><select id="model-select"></select></div><button class="form-button" id="fetch-models-btn">拉取模型</button>
<!-- ▼▼▼ 将这段代码粘贴到 API 设置页面的“保存设置”按钮上方 ▼▼▼ -->
<hr style="margin:20px 0; opacity:.3"/>
<div class="form-group" style="display: flex; justify-content: space-between; align-items: center;">
<label for="background-activity-switch" style="margin-bottom: 0;">
        啟用後台角色活動
        <p style="font-size: 12px; font-weight: normal; color: #ff6b6b; margin-top: 5px;">
            警告：此功能會顯著增加API調用和費用！
        </p>
</label>
<input id="background-activity-switch" style="width: auto; height: 20px;" type="checkbox"/>
</div>
<!-- ▲▲▲ 粘贴结束 ▲▲▲ -->
<!-- ▼▼▼ 将这段代码粘贴到“启用后台角色活动”开关的下方 ▼▼▼ -->
<div class="form-group" style="display: flex; justify-content: space-between; align-items: center; margin-top: 10px;">
<label for="background-interval-input" style="margin-bottom: 0;">
        後台活動偵測間隔 (秒)
        <p style="font-size: 12px; font-weight: normal; color: #999; margin-top: 5px;">
            建議值 60-300。數值越大，費用越低，但角色反應越慢。
        </p>
</label>
<input id="background-interval-input" min="30" style="width: 80px; text-align: center;" type="number" value="60"/>
</div>
<!-- ▲▲▲ 粘贴结束 ▲▲▲ -->
<!-- ▼▼▼ 在这里新增 ▼▼▼ -->
<div class="form-group" style="display: flex; justify-content: space-between; align-items: center; margin-top: 10px;">
<label for="block-cooldown-input" style="margin-bottom: 0;">
        AI被封鎖後冷靜期 (小時)
        <p style="font-size: 12px; font-weight: normal; color: #999; margin-top: 5px;">
            被封鎖超過這個時間後，AI才有幾率重新申請好友。
        </p>
</label>
<input id="block-cooldown-input" min="0.1" step="0.1" style="width: 80px; text-align: center;" type="number" value="1"/>
</div>
<!-- ▲▲▲ 新增结束 ▲▲▲ -->
<button class="form-button" id="save-api-settings-btn">保存設置</button>
<hr style="margin:20px 0; opacity:.3"/>
<button class="form-button" id="export-data-btn">匯出數據</button>
<!-- ① 普通按钮，和“导出”一个 class -->
<button class="form-button" id="import-btn">導入備份文件</button>
<!-- ② 真正的文件选择器，完全隐藏 -->
<input accept="application/json" hidden="" id="import-data-input" type="file"/>
</div></div>
<!-- ▼▼▼ 用下面这段代码，完整替换掉你原来的 chat-list-screen ▼▼▼ -->
<div class="screen" id="chat-list-screen">
<!-- 主头部 (只在消息列表显示) -->
<div class="header" id="main-chat-list-header">
<span class="back-btn" onclick="showScreen('home-screen')">‹</span>
<span id="chat-list-title">訊息</span>
<div class="header-actions">
<span class="action-btn" id="add-group-chat-btn" title="创建群聊"><svg fill="none" height="24" viewbox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg"><path d="M17.5 17.5C19.1569 17.5 20.5 16.1569 20.5 14.5C20.5 12.8431 19.1569 11.5 17.5 11.5C15.8431 11.5 14.5 12.8431 14.5 14.5C14.5 16.1569 15.8431 17.5 17.5 17.5Z" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"></path><path d="M21 21L19 19" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"></path><path d="M8.5 11.5C10.1569 11.5 11.5 10.1569 11.5 8.5C11.5 6.84315 10.1569 5.5 8.5 5.5C6.84315 5.5 5.5 6.84315 5.5 8.5C5.5 10.1569 6.84315 11.5 8.5 11.5Z" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"></path><path d="M12.5 14.5H4.5C3.39543 14.5 2.5 15.3954 2.5 16.5V18.5H12.5" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"></path></svg></span>
<span class="action-btn" id="add-chat-btn">+</span>
</div>
</div>
<!-- 消息列表视图 -->
<div class="chat-list-view active" id="messages-view">
<div id="chat-list">
<!-- JS会在这里生成聊天列表 -->
</div>
</div>
<!-- 动态界面视图 -->
<div class="chat-list-view" id="qzone-screen">
<div class="qzone-header">
<span class="back-btn" id="qzone-back-btn">‹</span> <!-- 这个按钮现在只负责从动态返回 -->
<span>好友動態</span>
</div>
<div class="qzone-content">
<div class="qzone-profile-header">
<div class="qzone-banner-container" id="qzone-banner-container">
<img alt="背景" id="qzone-banner-img" src="https://files.catbox.moe/r5heyt.gif"/>
<input accept="image/*" hidden="" id="qzone-banner-input" type="file"/>
</div>
<div class="qzone-user-info">
<div class="qzone-avatar-container" id="qzone-avatar-container">
<img alt="頭像" id="qzone-avatar-img" src="https://files.catbox.moe/q6z5fc.jpeg"/>
<input accept="image/*" hidden="" id="qzone-avatar-input" type="file"/>
</div>
<span id="qzone-nickname">{{user}}</span>
</div>
</div>
<div class="qzone-actions-bar">
<div class="action-item" id="create-shuoshuo-btn"><span>說說</span></div>
<div class="action-item" id="create-post-btn"><span>動態</span></div>
<div class="action-item" id="open-album-btn"><span>相冊</span></div>
</div>
<div id="qzone-posts-list"></div>
</div>
</div>
<!-- 收藏界面视图 -->
<div class="chat-list-view" id="favorites-view">
<div class="header">
<span class="back-btn" id="favorites-back-btn">‹</span>
<span>我的收藏</span>
<!-- 新增的编辑按钮 -->
<span class="action-btn" id="favorites-edit-btn">編輯</span>
</div>
<!-- 【新增】搜索栏容器 -->
<div class="search-bar-container">
<input id="favorites-search-input" placeholder="搜尋收藏的標題、內容或作者..." type="search"/>
<button class="search-clear-btn" id="favorites-search-clear-btn" style="display: none;">×</button>
</div>
<div class="list-container" id="favorites-list">
<!-- 收藏内容将由JS动态生成在这里 -->
</div>
<!-- 新增：收藏页底部操作栏 -->
<div id="favorites-action-bar" style="display: none;">
<button class="action-bar-btn" id="favorites-delete-selected-btn">删除 (0)</button>
</div>
</div>
<!-- ▼▼▼ 【全新】回忆录界面视图 ▼▼▼ -->
<div class="chat-list-view" id="memories-view">
<div class="header">
<span class="back-btn" id="memories-back-btn">‹</span>
<span>我們的回憶</span>
<span class="action-btn" id="add-countdown-btn">+</span>
</div>
<div class="list-container" id="memories-list" style="padding: 15px; display: flex; flex-direction: column; gap: 15px;">
<!-- 回忆卡片将由JS动态生成在这里 -->
</div>
</div>
<!-- ▲▲▲ 新增HTML结束 ▲▲▲ -->
<!-- 底部导航栏 -->
<div id="chat-list-bottom-nav">
<div class="nav-item active" data-view="messages-view">
<span>訊息</span>
</div>
<div class="nav-item" data-view="qzone-screen">
<span>動態</span>
</div>
<!-- ▼▼▼ 在“动态”和“收藏”之间，加入这个新页签 ▼▼▼ -->
<div class="nav-item" data-view="memories-view">
<span>回憶</span>
</div>
<!-- ▲▲▲ 添加结束 ▲▲▲ -->

<div class="nav-item" data-view="favorites-view">
<span>收藏</span>
</div>
</div>
</div>
<!-- ▲▲▲ 替换区域结束 ▲▲▲ -->
<!-- ▼▼▼ 请将这段新的 HTML 粘贴到 id="chat-list-screen" 的 div 之后 ▼▼▼ -->
<div class="screen" id="album-screen">
<!-- 1. 页面头部，包含返回按钮和标题 -->
<div class="header">
<span class="back-btn" id="album-back-btn">‹</span>
<span>我的相冊</span>
<span class="action-btn" id="create-album-btn-page">+</span>
</div>
<!-- 2. 页面内容容器 -->
<div class="list-container">
<div id="album-grid-page">
<!-- 相册列表将由 JS 动态生成在这里 -->
</div>
</div>
</div>
<!-- ▲▲▲ 新的 HTML 粘贴结束 ▲▲▲ -->
<!-- ▼▼▼ 请将这段新的 HTML 粘贴到 id="album-screen" 的 div 之后 ▼▼▼ -->
<div class="screen" id="album-photos-screen">
<!-- 1. 页面头部 -->
<div class="header">
<span class="back-btn" id="album-photos-back-btn">‹</span>
<span id="album-photos-title">相冊名稱</span>
<span class="action-btn" id="album-upload-photo-btn">上傳</span>
</div>
<!-- 2. 页面内容容器 -->
<div class="list-container">
<div id="photos-grid-page">
<!-- 照片列表将由 JS 动态生成在这里 -->
</div>
<!-- ▼▼▼ 请将这段新的 HTML 粘贴到所有模态框的末尾 ▼▼▼ -->
<div class="modal" id="photo-viewer-modal">
<!-- 1. 关闭按钮 -->
<button id="photo-viewer-close-btn">×</button>
<!-- 2. 上一张照片按钮 -->
<button class="nav-arrow" id="photo-viewer-prev-btn">‹</button>
<!-- 3. 图片容器 -->
<div class="photo-viewer-content">
<img alt="全螢幕照片預覽" id="photo-viewer-image" src=""/>
</div>
<!-- 4. 下一张照片按钮 -->
<button class="nav-arrow" id="photo-viewer-next-btn">›</button>
</div>
<!-- ▲▲▲ 新的 HTML 粘贴结束 ▲▲▲ -->
</div>
</div>
<!-- ▲▲▲ 新的 HTML 粘贴结束 ▲▲▲ -->
<!-- ▼▼▼ 粘贴到 #album-photos-screen 的 div 之后 ▼▼▼ -->
<input accept="image/*" hidden="" id="album-photo-input" multiple="" type="file"/>
<!-- ▼▼▼ 请用这【一整块】全新的代码，完整替换掉您文件中旧的 #chat-interface-screen 及其所有内容 ▼▼▼ -->
<div class="screen" id="chat-interface-screen">
<!-- 【最终修正版】Header，已将状态栏和搜索功能正确整合 -->
<div class="header">
<!-- 默认控件：包含标题、状态栏和常规按钮 -->
<div class="default-controls">
<span class="back-btn" id="back-to-list-btn">‹</span>
<!-- ▼▼▼ 【核心新增】标题和状态的容器 ▼▼▼ -->
<div id="chat-header-title-wrapper">
<span id="chat-header-title">聊天對象</span>
<div id="chat-header-status">
<span class="status-dot"></span>
<span class="status-text">在線</span>
</div>
</div>
<!-- ▲▲▲ 新增结束 ▲▲▲ -->
<div class="header-actions">
<span class="action-btn" id="listen-together-btn" title="一起聽"><img alt="一起聽" src="https://i.postimg.cc/dV8sdNcx/210-20250618115221.png"/></span>
<span class="action-btn" id="chat-settings-btn" title="聊天設置"><img alt="設置" src="https://i.postimg.cc/bvPq64cv/CCA834-BA-5-A90-408-D-94-FA-7-EE156-B6-A765.png"/></span>
</div>
</div>
<!-- 多选模式控件 (保持不变) -->
<div class="selection-controls">
<span id="selection-cancel-btn">取消</span>
<span id="selection-count"></span>
<div class="header-actions">
<span class="action-btn" id="selection-favorite-btn">收藏</span>
<span class="action-btn" id="selection-share-btn">分享</span>
<span class="action-btn" id="selection-delete-btn" style="color: #ff3b30;">删除</span>
</div>
</div>
</div>
<!-- 聊天消息区域 (保持不变) -->
<div id="chat-messages"><div id="typing-indicator">對方正在輸入...</div></div>
<!-- 输入区域 (保持不变) -->
<div id="chat-input-area">
        <div id="action-sheet" hidden>
  <div class="sheet-mask"></div>
  <div class="sheet-panel" role="menu" aria-label="+ actions"></div>
</div>

<div id="reply-preview-bar">
<div class="reply-preview-content">
<div class="sender">回复 xxx:</div>
<div class="text">被引用的訊息內容...</div>
</div>
<span id="cancel-reply-btn">×</span>
</div>
<div id="chat-input-actions-top">
<button class="chat-action-icon-btn action-button" id="open-sticker-panel-btn" title="表情面板">+</button>
<button class="chat-action-icon-btn action-button" id="send-photo-btn" title="發送照片"><svg fill="none" height="24" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewbox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg"><path d="M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"></path><circle cx="12" cy="13" r="4"></circle></svg></button>
<button class="chat-action-icon-btn action-button" id="upload-image-btn" title="上傳圖片"><svg fill="none" height="24" style="color: var(--text-primary);" viewbox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg"><path d="M21 3.5H3C2.44772 3.5 2 3.94772 2 4.5V19.5C2 20.0523 2.44772 20.5 3 20.5H21C21.5523 20.5 22 20.0523 22 19.5V4.5C22 3.94772 21.5523 3.5 21 3.5Z" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"></path><path d="M16.5 13.5C17.6046 13.5 18.5 12.6046 18.5 11.5C18.5 10.3954 17.6046 9.5 16.5 9.5C15.3954 9.5 14.5 10.3954 14.5 11.5C14.5 12.6046 15.3954 13.5 16.5 13.5Z" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"></path><path d="M22 14.5L18 10.5L10.3333 18.5M12.5 16L9 12.5L2 19.5" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"></path></svg></button>
<button class="chat-action-icon-btn action-button" id="transfer-btn" title="轉帳">￥</button>
<button class="chat-action-icon-btn action-button" id="voice-message-btn" title="發送語音"><svg fill="none" height="24" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewbox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg"><path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"></path><path d="M19 10v2a7 7 0 0 1-14 0v-2"></path><path d="M12 19v4"></path><path d="M8 23h8"></path></svg></button>
<!-- ▼▼▼ 将这行新代码粘贴到“發送語音”按钮的后面 ▼▼▼ -->
<button class="chat-action-icon-btn action-button" id="send-waimai-request-btn" title="發起外送請求"><svg fill="none" height="24" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewbox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg"><path d="M6 2L3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4z"></path><line x1="3" x2="21" y1="6" y2="6"></line><path d="M16 10a4 4 0 0 1-8 0"></path></svg></button>
<!-- ▲▲▲ 新代码粘贴结束 ▲▲▲ -->
<!-- ▼▼▼ 【新增】视频通话按钮 ▼▼▼ -->
<button class="chat-action-icon-btn action-button" id="video-call-btn" title="視訊通話"><svg fill="none" height="24" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewbox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg"><polygon points="23 7 16 12 23 17 23 7"></polygon><rect height="14" rx="2" ry="2" width="15" x="1" y="5"></rect></svg></button>
<!-- ▲▲▲ 新增结束 ▲▲▲
<!-- ▼▼▼群视频通话按钮 ▼▼▼ -->
<button class="chat-action-icon-btn action-button" id="group-video-call-btn" title="群組視訊通話"><svg fill="none" height="24" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewbox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path><circle cx="9" cy="7" r="4"></circle><path d="M23 21v-2a4 4 0 0 0-3-3.87"></path><path d="M16 3.13a4 4 0 0 1 0 7.75"></path></svg></button>
<!-- ▲▲▲ 全新添加结束 ▲▲▲ -->
<!-- ▼▼▼发起投票按钮▼▼▼ -->
<button class="chat-action-icon-btn action-button" id="send-poll-btn" title="發起投票"><svg fill="none" height="24" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewbox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg"><path d="M8 6h10"></path><path d="M6 6h.01"></path><path d="M8 12h10"></path><path d="M6 12h.01"></path><path d="M8 18h10"></path><path d="M6 18h.01"></path></svg></button>
<!-- ▲▲▲ 替换结束 ▲▲▲ -->
<!-- ▼▼▼ 在 id="chat-input-actions-top" 的末尾，【添加】这个新的按钮 ▼▼▼ -->
<button class="chat-action-icon-btn action-button" id="share-link-btn" title="分享連結"><svg fill="none" height="24" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewbox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.72"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.72-1.72"></path></svg></button>
<!-- ▲▲▲ 新增HTML结束 ▲▲▲ -->
</div>
<div id="chat-input-main-row">
<textarea id="chat-input" placeholder="输入消息..." rows="1"></textarea>
<div id="input-actions-wrapper">
<button id="wait-reply-btn" title="等待回复"><img alt="等待回复" src="https://i.postimg.cc/q72zq80N/ECE92-BBC-BE57-48-E9-BB2-C-345-B6019-C4-B2.png"/></button>
<button class="action-button" id="send-btn">發送</button>
</div>
</div>
</div>
<!-- ▼▼▼ 在这里新增 ▼▼▼ -->
<div id="chat-lock-overlay">
<div id="chat-lock-content"></div>
</div>
<!-- ▲▲▲ 新增结束 ▲▲▲ -->
<!-- 表情面板 (保持不变) -->
<div id="sticker-panel">
<div id="sticker-panel-header">
<span class="panel-btn" id="close-sticker-panel-btn">取消</span>
<span class="title">我的表情</span>
<div style="display: flex; gap: 10px;">
<span class="panel-btn" id="add-sticker-btn">添加</span>
<span class="panel-btn" id="upload-sticker-btn">上傳</span>
</div>
</div>
<div id="sticker-grid"></div>
</div>
<input accept="image/*" id="sticker-upload-input" style="display: none;" type="file"/>
<input accept="image/*" id="image-upload-input" style="display: none;" type="file"/>
<!-- 音乐播放器 (保持不变) -->
<div id="music-player-overlay">
<div class="music-player-window">
<!-- 1. 顶部操作栏 -->
<div class="music-player-top-actions">
<div class="top-left-cluster">
<button id="music-return-btn">‹</button>
<button id="music-exit-btn">×</button>
</div>
<span id="music-playlist-btn">☰</span>
</div>
<!-- 2. 歌曲信息 -->
<div id="music-time-counter">已經一起聽了0.0小時</div>
<div id="music-player-song-title">請添加歌曲</div>
<div id="music-player-artist">...</div>
<!-- 3. 【全新】歌词显示区域 -->
<div id="music-lyrics-container">
<div id="music-lyrics-list">
<!-- 歌词将由JS动态生成在这里 -->
<div class="lyric-line">♪ 暫無歌詞 ♪</div>
</div>
</div>
<!-- 4. 【全新】播放控制区的包裹容器 -->
<div class="music-player-controls-wrapper">
<!-- a. 新的iOS风格进度条 -->
<div class="music-progress-bar-container">
<div class="time-display" id="music-current-time">0:00</div>
<div class="progress-bar">
<div class="progress-bar-fill" id="music-progress-fill"></div>
</div>
<div class="time-display" id="music-total-time">0:00</div>
</div>
<!-- b. 播放控制按钮 -->
<div class="music-controls">
<button id="music-prev-btn">◀</button>
<button class="play-pause-btn" id="music-play-pause-btn">▶</button>
<button id="music-next-btn">▶</button>
<button id="music-mode-btn">順序</button>
</div>
</div>
</div>
</div>
<div id="music-playlist-panel">
<div class="playlist-header">
<span class="panel-btn" id="close-playlist-btn">返回</span>
<span>播放列表</span>
<div>
<span class="panel-btn" id="add-song-local-btn">本地</span>
<span class="panel-btn" id="add-song-url-btn">URL</span>
</div>
</div>
<div class="playlist-body" id="playlist-body"></div>
</div>
<input accept="audio/*" id="local-song-upload-input" multiple="" style="display: none;" type="file"/>
<input accept=".lrc" id="lrc-upload-input" style="display: none;" type="file"/>
</div>
<!-- ▲▲▲ 替换结束 ▲▲▲ -->
<!-- ▼▼▼ 用这整块代码替换你原来的 id="wallpaper-screen" ▼▼▼ -->
<div class="screen" id="wallpaper-screen">
<div class="header">
<span class="back-btn" onclick="showScreen('home-screen')">‹</span>
<!-- 【核心修改1】标题改为“外观设置”，更通用 -->
<span>外觀設置</span>
<span style="width: 30px;"></span>
</div>
<div class="form-container">
<!-- 壁纸设置部分保持不变 -->
<div id="wallpaper-preview">點擊下方上傳</div>
<button class="form-button" onclick="document.getElementById('wallpaper-upload-input').click();">上傳壁紙</button>
<input accept="image/*" id="wallpaper-upload-input" type="file"/>
<!-- ▼▼▼ 将【上面整块代码】，完整替换为下面这段【全新的代码】 ▼▼▼ -->
<div class="form-group" style="display: flex; justify-content: space-between; align-items: center;">
<label for="theme-toggle-switch" style="margin-bottom: 0;">夜間模式</label>
<label class="toggle-switch">
<input id="theme-toggle-switch" type="checkbox"/>
<span class="slider"></span>
</label>
</div>
<!-- ▲▲▲ 替换结束 ▲▲▲ -->
<!-- 【核心修改2】新增图标设置区域 -->
<hr style="width: 80%; opacity: 0.3; margin: 30px 0;"/>
<div style="width:100%; text-align: left; margin-bottom: 15px;">
<label style="font-weight: 500; color: var(--text-secondary);">App 圖標設置</label>
</div>
<div id="icon-settings-grid">
<!-- 圖標設置項將由JS動態生成在這裡 -->
</div>
<!-- 【核心修改3】按钮文字也改一下 -->
<button class="form-button" id="save-wallpaper-btn" style="margin-top: 30px;">保存所有外觀設置</button>
</div>
</div>
<!-- ▲▲▲ 替换结束 ▲▲▲ -->
<!-- ▼▼▼ 【全新】分享链接功能 HTML ▼▼▼ -->
<div class="screen" id="browser-screen">
<div class="header">
<span class="back-btn" id="browser-back-btn">‹</span>
<span id="browser-title"></span>
<span style="width: 30px;"></span>
</div>
<div class="list-container" id="browser-content">
<!-- 文章内容将由JS动态生成在这里 -->
</div>
</div>
<!-- ▲▲▲ 新HTML粘贴结束 ▲▲▲ -->
<div class="screen" id="font-settings-screen">
<div class="header">
<span class="back-btn" onclick="showScreen('home-screen')">‹</span>
<span>字體設置</span>
<span style="width: 30px;"></span>
</div>
<div class="form-container">
<div class="form-group">
<label for="font-url-input">字體文件URL (.ttf, .otf, .woff等)</label>
<input id="font-url-input" placeholder="https://..../font.ttf" type="text"/>
</div>
<div class="form-group">
<label>實時預覽</label>
<div id="font-preview">
<p style="font-size: 20px; margin: 0 0 10px 0;">你好世界 Hello World</p>
<p style="margin: 0;">這是字體預覽效果，12345。</p>
</div>
</div>
<button class="form-button" id="save-font-btn">儲存並應用</button>
<button class="form-button form-button-secondary" id="reset-font-btn">恢復默認字體</button>
</div>
</div>
<!-- ▼▼▼ 【全新】选择联系人以创建群聊的屏幕 ▼▼▼ -->
<div class="screen" id="contact-picker-screen">
<div class="header">
<span class="back-btn" id="cancel-contact-picker-btn">取消</span>
<span>選擇聯絡人</span>
<span class="save-btn" id="confirm-contact-picker-btn">完成(0)</span>
</div>
<div class="list-container" id="contact-picker-list">
<!-- 联系人列表将由JS动态生成 -->
</div>
</div>
<!-- ▲▲▲ 新HTML粘贴结束 ▲▲▲ -->
<!-- ▼▼▼ 【全新】群成员管理屏幕 ▼▼▼ -->
<div class="screen" id="member-management-screen">
<div class="header">
<span class="back-btn" id="back-from-member-management">‹</span>
<span>群成員管理</span>
<span style="width: 30px;"></span>
</div>
<div class="list-container" id="member-management-list">
<!-- 现有成员列表会在这里动态生成 -->
</div>
<div id="member-management-actions">
<button id="add-existing-contact-btn">從好友列表添加</button>
<button id="create-new-member-btn">創建群內新成員</button>
</div>
</div>
<!-- ▲▲▲ 新HTML粘贴结束 ▲▲▲ -->
<!-- ▼▼▼ 【全新】来电请求模态框 ▼▼▼ -->
<div class="modal" id="incoming-call-modal">
<div class="incoming-call-content">
<img class="caller-avatar" id="caller-avatar" src=""/>
<div class="caller-name" id="caller-name"></div>
<div class="caller-text">邀請你視訊通話</div>
<div class="incoming-call-actions">
<div class="action-button-wrapper">
<button class="call-action-btn decline" id="decline-call-btn"></button>
<span>拒絕</span>
</div>
<div class="action-button-wrapper">
<button class="call-action-btn accept" id="accept-call-btn"></button>
<span>接聽</span>
</div>
</div>
</div>
</div>
<!-- ▲▲▲ 新增结束 ▲▲▲ -->
<!-- ▼▼▼ 请用这段【全新群聊兼容结构】的代码，完整替换你旧的 #video-call-screen ▼▼▼ -->
<div class="screen" id="video-call-screen">
<!-- 1. 顶部栏 (保持不变) -->
<div class="video-call-top-bar">
<span id="call-timer">00:00</span>
</div>
<!-- 2. 【升级】参与者头像网格区域 -->
<div class="video-call-avatar-area">
<div id="participant-avatars-grid">
<!-- JS会在这里动态生成头像 -->
</div>
</div>
<!-- 3. 对话框区域 (保持不变) -->
<div class="video-call-main" id="video-call-main">
<!-- 对话内容会动态生成在这里 -->
</div>
<!-- 4. 【升级】底部控制栏，现在包含一个“加入”按钮 -->
<div class="video-call-controls">
<button class="control-btn speak-btn" id="user-speak-btn"></button>
<button class="control-btn hangup-btn" id="hang-up-btn"></button>
<!-- 这个按钮默认隐藏，只在用户“旁观”时显示 -->
<button class="control-btn join-btn" id="join-call-btn" style="display: none;"></button>
</div>
</div>
<!-- ▲▲▲ 替换结束 ▲▲▲ -->
<!-- ▼▼▼ 【全新添加】正在呼叫界面 ▼▼▼ -->
<div class="screen" id="outgoing-call-screen">
<div class="outgoing-call-content">
<img class="caller-avatar" id="outgoing-call-avatar" src=""/>
<div class="caller-name" id="outgoing-call-name"></div>
<div class="caller-text">正在呼叫...</div>
<div class="outgoing-call-actions">
<button class="call-action-btn decline" id="cancel-call-btn"></button>
<span>取消</span>
</div>
</div>
</div>
<!-- ▲▲▲ 添加结束 ▲▲▲ -->
<!-- ▼▼▼ 【全新】通话记录页面 ▼▼▼ -->
<div class="screen" id="call-history-screen">
<div class="header">
<span class="back-btn" id="call-history-back-btn">‹</span>
<span id="call-history-title">通話記錄</span>
<span style="width: 30px;"></span> <!-- 占位符，保持标题居中 -->
</div>
<div class="list-container" id="call-history-list" style="padding: 15px; display: flex; flex-direction: column; gap: 15px;">
<!-- 通话记录卡片将由JS动态生成在这里 -->
</div>
</div>
<!-- ▲▲▲ 新HTML粘贴结束 ▲▲▲ -->
</div>

<div class="modal" id="chat-settings-modal"><div class="modal-content"><div class="modal-header"><span>聊天設置</span></div><div class="modal-body"><div class="form-group" id="chat-name-group"><label for="chat-name-input">備註名 / 群名</label><input id="chat-name-input" type="text"/></div>
<!-- ▼▼▼ 请将这段新代码粘贴到“备注名”输入框的 form-group 之后 ▼▼▼ -->
<div class="form-group" id="assign-group-section" style="display: none;"> <!-- 默认隐藏，只对单聊显示 -->
<label for="assign-group-select">好友分組</label>
<div style="display: flex; align-items: center; gap: 10px;">
<select id="assign-group-select" style="flex-grow: 1;">
<!-- 分组选项将由JS动态生成 -->
</select>
<button class="form-button-secondary" id="manage-groups-btn" style="margin-top: 0; padding: 12px;">管理分組</button>
</div>
</div>
<!-- ▲▲▲ 新代码粘贴结束 ▲▲▲ -->
<div class="form-group" id="my-group-nickname-group"><label for="my-group-nickname-input">我的群暱稱</label><input id="my-group-nickname-input" type="text"/></div><div class="form-group" id="group-avatar-group"><label>群頭像</label><div class="avatar-upload"><img id="group-avatar-preview"/><button onclick="document.getElementById('group-avatar-input').click()">上傳群頭像</button><input accept="image/*" id="group-avatar-input" type="file"/></div></div>
<div class="form-group" id="world-book-link-group">
<label>關聯世界書 (可多選)</label>
<div class="custom-multiselect">
<div class="select-box">
<span class="selected-options-text">-- 點選選擇 --</span>
<span class="arrow-down">▼</span>
</div>
<div class="checkboxes-container" id="world-book-checkboxes-container">
</div>
</div>
</div>
<div class="form-group" id="ai-persona-group"><label for="ai-persona">對方人設 (AI Persona)</label><textarea id="ai-persona" rows="3"></textarea></div><div class="form-group" id="ai-avatar-group"><label>對方頭像</label><div class="avatar-upload"><img id="ai-avatar-preview"/><button onclick="document.getElementById('ai-avatar-input').click()">上傳對方頭像</button><button id="manage-ai-avatar-library-btn">管理頭像庫</button>
<input accept="image/*" id="ai-avatar-input" type="file"/></div></div><div class="form-group" id="my-persona-group"><label for="my-persona">我的人設 (My Persona)</label><textarea id="my-persona" rows="3"></textarea></div><div class="form-group" id="my-avatar-group"><label>我的頭像</label><div class="avatar-upload"><img id="my-avatar-preview"/><button onclick="document.getElementById('my-avatar-input').click()">上傳我的頭像</button><button id="open-persona-library-btn">預設</button><input accept="image/*" id="my-avatar-input" type="file"/></div></div><div class="form-group" id="group-members-group"><label>群成員人設</label><div id="group-members-settings"></div>
<!-- 【新增】管理成员按钮 -->
<button class="form-button form-button-secondary" id="manage-members-btn" style="margin-top: 15px;">管理群成員</button></div>
<div class="form-group"><label for="max-memory">上下文記憶條數</label><input id="max-memory" type="number" value="10"/></div><div class="form-group"><label>聊天氣泡主題 <button id="reset-theme-btn" type="button">重置</button></label><div class="theme-selector"><label><input id="theme-default" name="theme-select" type="radio" value="default"/> 默認</label><label><input name="theme-select" type="radio" value="pink_blue"/> 粉藍</label><label><input name="theme-select" type="radio" value="blue_white"/> 藍白</label><label><input name="theme-select" type="radio" value="purple_yellow"/> 紫黄</label><label><input name="theme-select" type="radio" value="black_white"/> 黑白</label><label><input name="theme-select" type="radio" value="yellow_white"/> 黄白</label><label><input name="theme-select" type="radio" value="red_black"/> 紅黑</label><label><input name="theme-select" type="radio" value="blue_yellow"/> 藍黃</label><label><input name="theme-select" type="radio" value="pink_yellow"/> 粉黄</label><label><input name="theme-select" type="radio" value="pink_purple"/> 粉紫</label><label><input name="theme-select" type="radio" value="gray_white"/> 灰白</label><label><input name="theme-select" type="radio" value="blue_green"/> 藍綠</label><label><input name="theme-select" type="radio" value="pink_white"/> 粉白</label><label><input name="theme-select" type="radio" value="pink_black"/> 粉黑</label><label><input name="theme-select" type="radio" value="pink_green"/> 粉綠</label><label><input name="theme-select" type="radio" value="green_black"/> 綠黑</label></div></div>
<!-- ▼▼▼ 请将这段新代码粘贴到“聊天气泡主题”的 form-group 之后 ▼▼▼ -->
<div class="form-group">
<label for="font-size-slider">聊天字體大小 <span id="font-size-value">13px</span></label>
<input id="font-size-slider" max="20" min="12" step="1" style="width: 100%; margin-top: 8px;" type="range" value="13"/>
</div>
<!-- ▲▲▲ 新代码粘贴结束 ▲▲▲ -->
<!-- ▼▼▼ 请将这段新代码粘贴到“聊天字体大小”的 form-group 之后 ▼▼▼ -->
<div class="form-group">
<label for="custom-css-input">
        自訂義氣泡樣式 (CSS)
        <button id="reset-custom-css-btn" style="background: none; border: 1px solid #ccc; color: #555; font-size: 12px; padding: 2px 8px; border-radius: 5px; cursor: pointer; margin-left: 10px;" type="button">重置</button>
</label>
<textarea id="custom-css-input" placeholder="/* 範例：為「我」的氣泡添加漸層背景和陰影 */
.message-bubble.user .content {
  background: linear-gradient(135deg, #a1c4fd, #c2e9fb);
  box-shadow: 0 4px 10px rgba(0,0,0,0.1);
  border-radius: 15px 4px 15px 15px;
}" rows="5" style="width: 100%; margin-top: 8px; font-family: monospace; font-size: 12px; resize: vertical;"></textarea>
</div>
<!-- ▲▲▲ 新代码粘贴结束 ▲▲▲ -->
<!-- ▼▼▼ 请将这段新代码粘贴到自定义CSS输入框的 form-group 之后 ▼▼▼ -->
<div class="form-group">
<label>實時預覽</label>
<div id="settings-preview-area">
<!-- JS会在这里生成预览内容 -->
</div>
</div>
<!-- ▲▲▲ 新代码粘贴结束 ▲▲▲ -->
<div class="form-group">
<label>聊天背景</label>
<div class="bg-upload-container">
<button class="form-button-secondary" onclick="document.getElementById('bg-input').click()" style="width: auto; padding: 8px 12px; margin-top: 0;" type="button">上传背景图</button>
<button id="remove-bg-btn" type="button">移除背景</button>
</div>
<img class="bg-preview-img" id="bg-preview"/>
<input accept="image/*" id="bg-input" style="display: none;" type="file"/>
</div>
<hr style="margin: 25px 0; border: none; border-top: 1px solid #eee;"/>
<button class="form-button form-button-secondary" id="block-chat-btn" style="background-color: #ff3b30; color: white; border-color: #ff3b30;">拉黑對方</button>
<button class="form-button form-button-secondary" id="clear-chat-btn">清空聊天记录</button></div><div class="modal-footer"><button class="cancel" id="cancel-chat-settings-btn">取消</button><button class="save" id="save-chat-settings-btn">保存</button></div></div></div>
<div class="modal" id="persona-library-modal"><div class="modal-content"><div class="modal-header"><span>我的人設庫</span><button class="action-button" id="add-persona-preset-btn">新增</button></div><div class="modal-body"><div id="persona-library-grid"></div></div><div class="modal-footer"><button class="cancel" id="close-persona-library-btn">關閉</button></div></div></div>
<div class="modal" id="persona-editor-modal"><div class="modal-content"><div class="modal-header"><span id="persona-editor-title">新增人設預設</span></div><div class="modal-body"><div class="form-group"><label>預設頭像</label><div class="avatar-upload"><img id="preset-avatar-preview"/><button onclick="document.getElementById('preset-avatar-input').click()">上傳頭像</button><input accept="image/*" id="preset-avatar-input" type="file"/></div></div><div class="form-group"><label for="preset-persona-input">預設人設</label><textarea id="preset-persona-input" placeholder="在此輸入這個人設的詳細設定..." rows="4"></textarea></div></div><div class="modal-footer"><button class="cancel" id="cancel-persona-editor-btn">取消</button><button class="save" id="save-persona-preset-btn">保存</button></div></div></div>
<div class="modal" id="member-settings-modal"><div class="modal-content"><div class="modal-header"><span>編輯群成員</span></div><div class="modal-body">
<div class="form-group"><label for="member-name-input">名字</label><input id="member-name-input" type="text"/></div>
<div class="form-group"><label for="member-persona-input">人設</label><textarea id="member-persona-input" rows="4"></textarea></div>
<div class="form-group"><label>頭像</label><div class="avatar-upload"><img id="member-avatar-preview"/><button onclick="document.getElementById('member-avatar-input').click()">上傳頭像</button><input accept="image/*" id="member-avatar-input" type="file"/></div></div>
</div><div class="modal-footer"><button class="cancel" id="cancel-member-settings-btn">取消</button><button class="save" id="save-member-settings-btn">保存</button></div></div></div>
<div id="custom-modal-overlay">
<div id="custom-modal">
<div class="custom-modal-header" id="custom-modal-title"></div>
<div class="custom-modal-body" id="custom-modal-body"></div>
<div class="custom-modal-footer">
<button id="custom-modal-cancel">取消</button>
<button class="confirm-btn" id="custom-modal-confirm">確定</button>
</div>
</div>
</div>
<div class="modal" id="preset-actions-modal">
<div id="custom-modal" style="width: 250px;">
<div class="custom-modal-footer">
<button id="preset-action-edit">編輯預設</button>
<button class="btn-danger" id="preset-action-delete">刪除預設</button>
<button id="preset-action-cancel" style="margin-top: 8px; border-radius: 8px; background-color: #f0f0f0;">取消</button>
</div>
</div>
</div>
<div id="transfer-modal">
<div class="transfer-content">
<div class="transfer-header">給Ta一個驚喜！</div>
<div class="transfer-input-group">
<label for="transfer-amount">轉帳金額</label>
<input id="transfer-amount" max="9999" min="0" placeholder="0.00" step="0.01" type="number"/>
</div>
<div class="transfer-input-group">
<label for="transfer-note">備註 (可選)</label>
<input id="transfer-note" maxlength="20" placeholder="留下你的小心思~" type="text"/>
</div>
<div class="transfer-actions">
<button id="transfer-cancel-btn">取消</button>
<button id="transfer-confirm-btn">確認轉帳</button>
</div>
</div>
</div>
<div id="battery-alert-modal">
<div class="battery-alert-content">
<img id="battery-alert-image" src=""/>
<p id="battery-alert-text"></p>
</div>
</div>
<audio id="audio-player" style="display:none;"></audio>
<!-- ▼▼▼ 用下面这段【完整】的模态框代码，替换掉你现有的 id="create-post-modal" 的整个 div ▼▼▼ -->
<div class="modal" id="create-post-modal">
<div class="modal-content" style="height: auto; max-height: 90%;">
<div class="modal-header">
<span>發布動態</span>
</div>
<div class="modal-body">
<!-- 公开文字输入区 -->
<div class="form-group">
<textarea id="post-public-text" placeholder="分享新鮮事...（非必填的公開文字）" rows="3"></textarea>
</div>
<!-- === 模式切换开关 (新增) === -->
<div class="post-mode-switcher">
<button class="mode-btn active" id="switch-to-image-mode">上傳圖片</button>
<button class="mode-btn" id="switch-to-text-image-mode">使用文字圖</button>
</div>
<!-- ▼▼▼ 【修正后】的可见范围设置 ▼▼▼ -->
<div class="form-group">
<label>可見範圍</label>
<div id="post-visibility-options" style="display: flex; gap: 15px; margin-bottom: 10px;">
<label><input checked="" name="visibility" type="radio" value="public"/> 公開</label>
<label><input name="visibility" type="radio" value="include"/> 指定分組可見</label>
</div>
<div id="post-visibility-groups" style="display: none; max-height: 120px; overflow-y: auto; background: #f9f9f9; padding: 10px; border-radius: 8px;">
<!-- 分组多选框将由JS动态生成 -->
</div>
</div>
<!-- ▲▲▲ 修正结束 ▲▲▲ -->
<!-- === 图片模式区域 === -->
<div class="post-mode-content active" id="image-mode-content">
<div class="form-group">
<div class="post-image-preview-container" id="post-image-preview-container">
<img alt="圖片預覽" id="post-image-preview" src=""/>
<button id="post-remove-image-btn">×</button>
</div>
<div class="post-image-upload-options">
<button class="form-button-secondary" id="post-upload-local-btn">本地上傳</button>
<button class="form-button-secondary" id="post-use-url-btn">網路URL</button>
<input accept="image/*" hidden="" id="post-local-image-input" type="file"/>
</div>
</div>
<div class="form-group" id="post-image-desc-group" style="display: none;">
<label>圖片描述 (必填，給AI看)</label>
<input id="post-image-description" placeholder="簡單描述圖片內容，幫助AI理解" type="text"/>
</div>
</div>
<!-- === 文字图模式区域 (新增) === -->
<div class="post-mode-content" id="text-image-mode-content">
<div class="form-group">
<label>文字圖 (給AI理解用的描述，點擊圖片後可見)</label>
<textarea id="post-hidden-text" placeholder="在這裡寫下圖片描述..." rows="4"></textarea>
</div>
</div>
</div>
<div class="modal-footer">
<button class="cancel" id="cancel-create-post-btn">取消</button>
<button class="save" id="confirm-create-post-btn">發布</button>
</div>
</div>
</div>
<!-- ▲▲▲ 替换结束 ▲▲▲ -->
<!-- ▼▼▼ 请将这个新的模态框HTML粘贴到所有其他模态框之后 ▼▼▼ -->
<div class="modal" id="group-management-modal">
<div class="modal-content" style="height: 60%;">
<div class="modal-header">
<span>管理好友分組</span>
</div>
<div class="modal-body">
<div class="form-group">
<label>新建分組</label>
<div style="display: flex; gap: 10px;">
<input id="new-group-name-input" placeholder="輸入分組名..." style="flex-grow: 1;" type="text"/>
<button class="form-button" id="add-new-group-btn" style="width: auto; margin-top: 0; padding: 0 15px;">添加</button>
</div>
</div>
<hr style="opacity: 0.2;"/>
<div id="existing-groups-list" style="display: flex; flex-direction: column; gap: 10px;">
<!-- 分组列表将由JS动态生成 -->
</div>
</div>
<div class="modal-footer">
<button class="save" id="close-group-manager-btn" style="width: 100%;">完成</button>
</div>
</div>
</div>
<!-- ▲▲▲ 新代码粘贴结束 ▲▲▲ -->
<!-- ▼▼▼ 请将这段新HTML粘贴到所有模态框的末尾 ▼▼▼ -->
<div class="modal" id="message-actions-modal">
<div id="custom-modal" style="width: 250px;">
<div class="custom-modal-footer">
<!-- 新的操作按钮 -->
<button id="edit-message-btn">編輯訊息</button>
<button id="copy-message-btn">複製文本</button>
<button id="recall-message-btn">撤回</button>
<button id="quote-message-btn">引用</button>
<button id="select-message-btn">進入多選</button>
<!-- 取消按钮 -->
<button id="cancel-message-action-btn" style="margin-top: 8px; border-radius: 8px; background-color: #f0f0f0;">取消</button>
</div>
</div>
</div>
<!-- ▲▲▲ 新HTML粘贴结束 ▲▲▲ -->
<!-- ▼▼▼ 请将这段新HTML粘贴到所有模态框的末尾 ▼▼▼ -->
<div class="modal" id="post-actions-modal">
<div id="custom-modal" style="width: 250px;">
<div class="custom-modal-footer">
<button id="edit-post-btn">編輯動態</button>
<button id="copy-post-btn">複製內容</button>
<button id="cancel-post-action-btn">取消</button>
</div>
</div>
</div>
<!-- ▲▲▲ 新HTML粘贴结束 ▲▲▲ -->
<!-- ▼▼▼ 【全新】可视化消息编辑器模态框 ▼▼▼ -->
<div class="modal" id="message-editor-modal">
<div class="modal-content" style="height: 75%;">
<div class="modal-header">
<span>編輯與拆分訊息</span>
</div>
<div class="modal-body" id="message-editor-body">
<!-- 編輯器容器，JS會在這裡動態生成文本框 -->
<div id="message-editor-container"></div>
<!-- 添加新消息的按鈕 -->
<button class="form-button form-button-secondary" id="add-message-editor-block-btn" style="margin-top: 15px;">
                [+] 新增下一則訊息
            </button>
</div>
<div class="modal-footer">
<button class="cancel" id="cancel-advanced-editor-btn">取消</button>
<button class="save" id="save-advanced-editor-btn">保存更改</button>
</div>
</div>
</div>
<!-- ▲▲▲ 新HTML粘贴结束 ▲▲▲ -->
<!-- ▼▼▼ 【全新】外卖请求模态框 ▼▼▼ -->
<div class="modal" id="waimai-request-modal">
<div class="modal-content" style="width: 290px;">
<div class="modal-header">
<span>發起外送代付</span>
</div>
<div class="modal-body">
<div class="form-group">
<label for="waimai-product-info">商品信息</label>
<input id="waimai-product-info" placeholder="例如：一杯楊枝甘露" type="text"/>
</div>
<div class="form-group">
<label for="waimai-amount">代付金額 (元)</label>
<input id="waimai-amount" min="0" placeholder="例如：21" step="0.01" type="number"/>
</div>
</div>
<div class="modal-footer">
<button class="cancel" id="waimai-cancel-btn">取消</button>
<button class="save" id="waimai-confirm-btn">發起請求</button>
</div>
</div>
</div>
<!-- ▼▼▼ 【全新】新建约定/倒计时模态框 ▼▼▼ -->
<div class="modal" id="create-countdown-modal">
<div class="modal-content" style="height: auto;">
<div class="modal-header">
<span>新建約定</span>
</div>
<div class="modal-body">
<div class="form-group">
<label for="countdown-title-input">約定標題</label>
<input id="countdown-title-input" placeholder="例如：我的生日" type="text"/>
</div>
<div class="form-group">
<label for="countdown-date-input">約定日期與時間</label>
<input id="countdown-date-input" type="datetime-local"/>
</div>
</div>
<div class="modal-footer">
<button class="cancel" id="cancel-create-countdown-btn">取消</button>
<button class="save" id="confirm-create-countdown-btn">保存約定</button>
</div>
</div>
</div>
<!-- ▲▲▲ 新HTML粘贴结束 ▲▲▲ -->
<!-- ▼▼▼ 【全新】发红包模态框 ▼▼▼ -->
<div class="modal" id="red-packet-modal">
<div class="modal-content" style="width: 300px; height: auto;">
<div class="modal-header">
<span>發紅包</span>
</div>
<div class="modal-body" style="padding: 0;">
<!-- 1. 页签切换 -->
<div class="frame-tabs">
<div class="frame-tab active" id="rp-tab-group">拼手氣紅包</div>
<div class="frame-tab" id="rp-tab-direct">專屬紅包</div>
</div>
<!-- 2. 拼手气红包内容区 -->
<div class="frame-content" id="rp-content-group" style="padding: 20px 15px;">
<div class="form-group">
<label>總金額 (元)</label>
<input id="rp-group-amount" placeholder="0.00" type="number"/>
</div>
<div class="form-group">
<label>紅包個數</label>
<input id="rp-group-count" placeholder="填寫紅包個數" type="number"/>
</div>
<div class="form-group">
<label>祝福語</label>
<input id="rp-group-greeting" placeholder="恭喜發財，大吉大利！" type="text"/>
</div>
<p id="rp-group-total" style="text-align: center; font-size: 24px; font-weight: bold; margin: 10px 0;">¥ 0.00</p>
<button class="form-button" id="send-group-packet-btn">塞錢進紅包</button>
</div>
<!-- 3. 專屬紅包內容區 -->
<div class="frame-content" id="rp-content-direct" style="display: none; padding: 20px 15px;">
<div class="form-group">
<label>發送給</label>
<select id="rp-direct-receiver"></select>
</div>
<div class="form-group">
<label>金額 (元)</label>
<input id="rp-direct-amount" placeholder="0.00" type="number"/>
</div>
<div class="form-group">
<label>祝福語</label>
<input id="rp-direct-greeting" placeholder="恭喜發財，大吉大利！" type="text"/>
</div>
<p id="rp-direct-total" style="text-align: center; font-size: 24px; font-weight: bold; margin: 10px 0;">¥ 0.00</p>
<button class="form-button" id="send-direct-packet-btn">塞錢進紅包</button>
</div>
</div>
<div class="modal-footer" style="justify-content: center;">
<button class="cancel" id="cancel-red-packet-btn" style="width: 100%;">取消</button>
</div>
</div>
</div>
<!-- ▲▲▲ 新HTML粘贴结束 ▲▲▲ -->
<!-- ▼▼▼ 【全新】红包详情模态框 ▼▼▼ -->
<div class="modal" id="red-packet-details-modal">
<div class="modal-content" style="width: 280px; height: auto; background-color: #f7f7f7;">
<div class="modal-header" style="background-color: #F96259; color: white; border-bottom: none; padding-bottom: 5px;">
<div style="text-align: center; width: 100%;">
<div id="rp-details-sender" style="font-size: 16px;"></div>
<div style="font-size: 13px; opacity: 0.8;">的紅包</div>
</div>
</div>
<div class="modal-body" style="padding: 15px;">
<p id="rp-details-greeting" style="text-align: center; font-size: 20px; color: #333; margin: 0 0 20px 0;"></p>
<div id="rp-details-my-amount" style="text-align: center; display: none; margin-bottom: 20px;">
<span style="font-size: 40px; font-weight: bold; color: #E44D44;">0.00</span>
<span style="font-size: 18px; color: #E44D44;">元</span>
</div>
<div id="rp-details-summary" style="font-size: 13px; color: #8a8a8a; border-top: 1px solid #e0e0e0; padding-top: 10px;"></div>
<div id="rp-details-list" style="max-height: 150px; overflow-y: auto; margin-top: 10px;">
<!-- 领取详情将由JS动态生成在这里 -->
</div>
</div>
<div class="modal-footer">
<button class="save" id="close-rp-details-btn" style="width: 100%;">關閉</button>
</div>
</div>
</div>
<!-- ▲▲▲ 新HTML粘贴结束 ▲▲▲ -->
<!-- ▼▼▼ 【全新】创建投票模态框 ▼▼▼ -->
<div class="modal" id="create-poll-modal">
<div class="modal-content" style="width: 300px; height: auto;">
<div class="modal-header">
<span>發起投票</span>
</div>
<div class="modal-body">
<div class="form-group">
<label for="poll-question-input">投票問題</label>
<textarea id="poll-question-input" placeholder="例如：今晚我們看什麼電影？" rows="2"></textarea>
</div>
<div class="form-group">
<label>投票選項 (至少2項)</label>
<div id="poll-options-container" style="display: flex; flex-direction: column; gap: 8px;">
<!-- 投票選項將由JS動態生成在這裡 -->
</div>
<button class="form-button form-button-secondary" id="add-poll-option-btn" style="margin-top: 12px;">+ 添加選項</button>
</div>
</div>
<div class="modal-footer">
<button class="cancel" id="cancel-create-poll-btn">取消</button>
<button class="save" id="confirm-create-poll-btn">發起投票</button>
</div>
</div>
</div>
<!-- ▲▲▲ 新HTML粘贴结束 ▲▲▲ -->
<!-- ▼▼▼ 【全新】AI头像库管理模态框 ▼▼▼ -->
<div class="modal" id="ai-avatar-library-modal">
<div class="modal-content" style="height: 70%;">
<div class="modal-header">
<span id="ai-avatar-library-title">對方的頭像庫</span>
<button class="action-button" id="add-ai-avatar-btn">添加</button>
</div>
<div class="modal-body" style="padding: 15px;">
<div id="ai-avatar-library-grid" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(80px, 1fr)); gap: 15px;">
<!-- 头像库内容将由JS动态生成 -->
</div>
</div>
<div class="modal-footer">
<button class="save" id="close-ai-avatar-library-btn" style="width: 100%;">關閉</button>
</div>
</div>
</div>
<!-- ▲▲▲ 新HTML粘贴结束 ▲▲▲ -->
<!-- ▼▼▼ 【全新】用户分享链接模态框 ▼▼▼ -->
<div class="modal" id="share-link-modal">
<div class="modal-content" style="width: 300px; height: auto;">
<div class="modal-header">
<span>分享鏈接</span>
</div>
<div class="modal-body">
<div class="form-group">
<label for="link-title-input">標題</label>
<input id="link-title-input" placeholder="輸入文章或鏈接的標題" type="text"/>
</div>
<div class="form-group">
<label for="link-description-input">摘要 (可選)</label>
<textarea id="link-description-input" placeholder="簡單描述一下鏈接內容" rows="2"></textarea>
</div>
<div class="form-group">
<label for="link-source-input">來源名稱 (可選)</label>
<input id="link-source-input" placeholder="例如：知乎日報、B站" type="text"/>
</div>
<div class="form-group">
<label for="link-content-input">完整內容 (可選，用於瀏覽器內顯示)</label>
<textarea id="link-content-input" placeholder="粘貼或輸入完整的文章內容" rows="4"></textarea>
</div>
</div>
<div class="modal-footer">
<button class="cancel" id="cancel-share-link-btn">取消</button>
<button class="save" id="confirm-share-link-btn">分享</button>
</div>
</div>
</div>
<!-- ▲▲▲ 新HTML粘贴结束 ▲▲▲ -->
<!-- ▼▼▼ 【全新】精致版转账操作弹窗 ▼▼▼ -->
<div class="modal" id="transfer-actions-modal">
<div class="transfer-actions-content">
<div class="transfer-actions-header">請選擇操作</div>
<div class="transfer-actions-body">
<p>你收到了來自 <strong id="transfer-sender-name"></strong> 的一筆轉帳。</p>
</div>
<div class="transfer-actions-footer">
<button class="action-btn decline" id="transfer-action-decline">殘忍拒絕</button>
<button class="action-btn accept" id="transfer-action-accept">開心收下</button>
</div>
<button class="cancel-btn" id="transfer-action-cancel">×</button>
</div>
</div>
<!-- ▲▲▲ 新HTML粘贴结束 ▲▲▲ -->
<!-- ▼▼▼ 【全新】通话记录详情模态框 ▼▼▼ -->
<div class="modal" id="call-transcript-modal">
<div class="modal-content" style="height: 70%;">
<div class="modal-header">
<span id="transcript-modal-title">通話詳情</span>
</div>
<div class="modal-body" id="transcript-modal-body" style="background-color: #f0f2f5;">
<!-- 通话文字记录将由JS动态生成在这里 -->
</div>
<div class="modal-footer">
<button class="cancel" id="delete-transcript-btn" style="background-color: #ff3b30; color: white; border-color: #ff3b30;">刪除記錄</button>
<button class="save" id="close-transcript-modal-btn" style="width: 100%;">關閉</button>
</div>
</div>
</div>
<!-- ▲▲▲ 新HTML粘贴结束 ▲▲▲ -->
<!-- ▼▼▼ 【全新】分享目标选择器模态框 ▼▼▼ -->
<div class="modal" id="share-target-modal">
<div class="modal-content" style="height: 70%;">
<div class="modal-header">
<span>分享到...</span>
</div>
<div class="modal-body" id="share-target-list" style="padding: 0;">
<!-- 聊天列表将由JS动态生成在这里 -->
</div>
<div class="modal-footer">
<button class="cancel" id="cancel-share-target-btn">取消</button>
<button class="save" id="confirm-share-target-btn">確認分享</button>
</div>
</div>
</div>
<!-- ▼▼▼ 【全新】分享记录查看器模态框 ▼▼▼ -->
<div class="modal" id="shared-history-viewer-modal">
<div class="modal-content" style="height: 80%;">
<div class="modal-header">
<span id="shared-history-viewer-title">聊天記錄</span>
</div>
<div class="modal-body" id="shared-history-viewer-content" style="background-color: #f0f2f5;">
<!-- 分享的聊天记录气泡将由JS动态生成在这里 -->
</div>
<div class="modal-footer">
<button class="save" id="close-shared-history-viewer-btn" style="width:100%;">關閉</button>
</div>
</div>
</div>
<!-- ▼▼▼ 【全新】世界書分类管理模态框 ▼▼▼ -->
<div class="modal" id="world-book-category-manager-modal">
<div class="modal-content" style="height: 60%;">
<div class="modal-header">
<span>管理世界書分類</span>
</div>
<div class="modal-body">
<div class="form-group">
<label>新建分類</label>
<div style="display: flex; gap: 10px;">
<input id="new-category-name-input" placeholder="輸入分類名..." style="flex-grow: 1;" type="text"/>
<button class="form-button" id="add-new-category-btn" style="width: auto; margin-top: 0; padding: 0 15px;">添加</button>
</div>
</div>
<hr style="opacity: 0.2;"/>
<div id="existing-categories-list" style="display: flex; flex-direction: column; gap: 10px;">
<!-- 分类列表将由JS动态生成 -->
</div>
</div>
<div class="modal-footer">
<button class="save" id="close-category-manager-btn" style="width: 100%;">完成</button>
</div>
</div>
</div>
<!-- ▲▲▲ 新HTML粘贴结束 ▲▲▲ -->

<script defer="" src="./app.js"></script></body>
</html>
